{"version":3,"sources":["../../src/Service/CrawlService.js"],"names":["CrawlService","Service","start","urlsRepository","JsonUrlsRepository","getPathJsonUrlsFile","htmlRepository","HtmlRepository","getProjectPath","crawlerRepository","CrawlerRepository","args","option","crawlStatesRepository","SqliteCrawlStatesRepository","initUrl","getSingleUrl","isSingle","initUrlsPool","findAllUrls","progress","emitProgress","html","url","save","then","urls","emitComplete"],"mappings":";;;;;;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;;;AAEA;;;AAGe,MAAMA,YAAN,SAA2BC,gBAA3B,CAAmC;AAChD;;;AAGAC,EAAAA,KAAK,GAAG;AACN,QAAIC,cAAc,GAAG,IAAIC,2BAAJ,CAAuB,KAAKC,mBAAL,EAAvB,CAArB;AACA,QAAIC,cAAc,GAAG,IAAIC,uBAAJ,CAAmB,KAAKC,cAAL,EAAnB,CAArB;AACA,QAAIC,iBAAiB,GAAG,IAAIC,0BAAJ,CAAsB,KAAKC,IAA3B,EAAiC,KAAKC,MAAtC,CAAxB;AAEA,QAAIC,qBAAqB,GAAG,IAAIC,oCAAJ,CAC1B,KAAKN,cAAL,EAD0B,CAA5B;AAGAC,IAAAA,iBAAiB,CAACI,qBAAlB,GAA0CA,qBAA1C;AAEA,UAAME,OAAO,GAAG,KAAKJ,IAAL,CAAUK,YAAV,EAAhB;;AACA,QAAI,KAAKL,IAAL,CAAUM,QAAV,MAAwBF,OAAO,IAAI,IAAvC,EAA6C;AAC3CF,MAAAA,qBAAqB,CAACK,YAAtB,CAAmC,CAACH,OAAD,CAAnC;AACD;;AACDN,IAAAA,iBAAiB,CACdU,WADH,CACgBC,QAAD,IAAwB;AACnC,WAAKC,YAAL,CAAkBD,QAAlB;;AACA,UAAI,KAAKT,IAAL,CAAUW,IAAV,IAAkBF,QAAQ,CAACG,GAAT,IAAgB,IAAlC,IAA0CH,QAAQ,CAACE,IAAT,IAAiB,IAA/D,EAAqE;AACnEhB,QAAAA,cAAc,CAACkB,IAAf,CAAoBJ,QAAQ,CAACG,GAA7B,EAAkCH,QAAQ,CAACE,IAA3C,EAAiDG,IAAjD;AACD;AACF,KANH,EAOGA,IAPH,CAOQC,IAAI,IAAI;AACZvB,MAAAA,cAAc,CAACqB,IAAf,CAAoBE,IAApB,EAA0BD,IAA1B,CAA+B,MAAM,KAAKE,YAAL,EAArC;AACD,KATH;AAUD;;AA5B+C","sourcesContent":["// @flow\r\nimport Service from \"./Service\";\r\nimport Progress from \"../Model/Progress\";\r\nimport JsonUrlsRepository from \"../Repository/JsonUrlsRepository\";\r\nimport CrawlerRepository from \"../Repository/CrawlerRepository\";\r\nimport HtmlRepository from \"../Repository/HtmlRepository\";\r\n\r\nimport SqliteCrawlStatesRepository from \"../Repository/SqliteCrawlStatesRepository\";\r\n\r\n/**\r\n * This service will extract all the urls from a domain by crawling a site.\r\n */\r\nexport default class CrawlService extends Service {\r\n  /**\r\n   * Start the crawl service to extract the domain urls.\r\n   */\r\n  start() {\r\n    let urlsRepository = new JsonUrlsRepository(this.getPathJsonUrlsFile());\r\n    let htmlRepository = new HtmlRepository(this.getProjectPath());\r\n    let crawlerRepository = new CrawlerRepository(this.args, this.option);\r\n\r\n    let crawlStatesRepository = new SqliteCrawlStatesRepository(\r\n      this.getProjectPath()\r\n    );\r\n    crawlerRepository.crawlStatesRepository = crawlStatesRepository;\r\n\r\n    const initUrl = this.args.getSingleUrl();\r\n    if (this.args.isSingle() && initUrl != null) {\r\n      crawlStatesRepository.initUrlsPool([initUrl]);\r\n    }\r\n    crawlerRepository\r\n      .findAllUrls((progress: Progress) => {\r\n        this.emitProgress(progress);\r\n        if (this.args.html && progress.url != null && progress.html != null) {\r\n          htmlRepository.save(progress.url, progress.html).then();\r\n        }\r\n      })\r\n      .then(urls => {\r\n        urlsRepository.save(urls).then(() => this.emitComplete());\r\n      });\r\n  }\r\n}\r\n"],"file":"CrawlService.js"}