{"version":3,"sources":["../../src/Service/CrawlService.js"],"names":["Service","Progress","JsonUrlsRepository","CrawlerRepository","HtmlRepository","SqliteCrawlStatesRepository","HeadersRepository","CrawlService","start","urlsRepository","getPathJsonUrlsFile","htmlRepository","getProjectPath","headersRepository","crawlerRepository","args","option","crawlStatesRepository","initUrl","getSingleUrl","isSingle","initUrlsPool","findAllUrls","progress","emitProgress","html","url","save","then","headers","urls","emitComplete"],"mappings":"AACA,OAAOA,OAAP,MAAoB,cAApB;AACA,OAAOC,QAAP,MAAqB,sBAArB;AACA,OAAOC,kBAAP,MAA+B,qCAA/B;AACA,OAAOC,iBAAP,MAA8B,oCAA9B;AACA,OAAOC,cAAP,MAA2B,iCAA3B;AAEA,OAAOC,2BAAP,MAAwC,8CAAxC;AACA,OAAOC,iBAAP,MAA8B,oCAA9B;AAEA;;;;AAGA,eAAe,MAAMC,YAAN,SAA2BP,OAA3B,CAAmC;AAC9C;;;AAGAQ,EAAAA,KAAK,GAAG;AACJ,QAAIC,cAAc,GAAG,IAAIP,kBAAJ,CAAuB,KAAKQ,mBAAL,EAAvB,CAArB;AACA,QAAIC,cAAc,GAAG,IAAIP,cAAJ,CAAmB,KAAKQ,cAAL,EAAnB,CAArB;AACA,QAAIC,iBAAiB,GAAG,IAAIP,iBAAJ,CAAsB,KAAKM,cAAL,EAAtB,CAAxB;AACA,QAAIE,iBAAiB,GAAG,IAAIX,iBAAJ,CAAsB,KAAKY,IAA3B,EAAiC,KAAKC,MAAtC,EAA8C,KAAKJ,cAAL,EAA9C,CAAxB;AAEA,QAAIK,qBAAqB,GAAG,IAAIZ,2BAAJ,CACxB,KAAKO,cAAL,EADwB,CAA5B;AAGAE,IAAAA,iBAAiB,CAACG,qBAAlB,GAA0CA,qBAA1C;AAEA,UAAMC,OAAO,GAAG,KAAKH,IAAL,CAAUI,YAAV,EAAhB;;AACA,QAAI,KAAKJ,IAAL,CAAUK,QAAV,MAAwBF,OAAO,IAAI,IAAvC,EAA6C;AACzCD,MAAAA,qBAAqB,CAACI,YAAtB,CAAmC,CAACH,OAAD,CAAnC;AACH;;AACDJ,IAAAA,iBAAiB,CACZQ,WADL,CACkBC,QAAD,IAAwB;AACjC,WAAKC,YAAL,CAAkBD,QAAlB;;AACA,UAAI,KAAKR,IAAL,CAAUU,IAAV,IAAkBF,QAAQ,CAACG,GAAT,IAAgB,IAAlC,IAA0CH,QAAQ,CAACE,IAAT,IAAiB,IAA/D,EAAqE;AACjEd,QAAAA,cAAc,CAACgB,IAAf,CAAoBJ,QAAQ,CAACG,GAA7B,EAAkCH,QAAQ,CAACE,IAA3C,EAAiDG,IAAjD;AACH;;AACD,UAAI,KAAKb,IAAL,CAAUc,OAAV,IAAqBN,QAAQ,CAACG,GAAT,IAAgB,IAArC,IAA6CH,QAAQ,CAACM,OAAT,IAAoB,IAArE,EAA2E;AACvEhB,QAAAA,iBAAiB,CAACc,IAAlB,CAAuBJ,QAAQ,CAACG,GAAhC,EAAqCH,QAAQ,CAACM,OAA9C,EAAuDD,IAAvD;AACH;AACJ,KATL,EAUKA,IAVL,CAUUE,IAAI,IAAI;AACVrB,MAAAA,cAAc,CAACkB,IAAf,CAAoBG,IAApB,EAA0BF,IAA1B,CAA+B,MAAM,KAAKG,YAAL,EAArC;AACH,KAZL;AAaH;;AAhC6C","sourcesContent":["// @flow\nimport Service from \"./Service.js\";\nimport Progress from \"../Model/Progress.js\";\nimport JsonUrlsRepository from \"../Repository/JsonUrlsRepository.js\";\nimport CrawlerRepository from \"../Repository/CrawlerRepository.js\";\nimport HtmlRepository from \"../Repository/HtmlRepository.js\";\n\nimport SqliteCrawlStatesRepository from \"../Repository/SqliteCrawlStatesRepository.js\";\nimport HeadersRepository from \"../Repository/HeadersRepository.js\";\n\n/**\n * This service will extract all the urls from a domain by crawling a site.\n */\nexport default class CrawlService extends Service {\n    /**\n     * Start the crawl service to extract the domain urls.\n     */\n    start() {\n        let urlsRepository = new JsonUrlsRepository(this.getPathJsonUrlsFile());\n        let htmlRepository = new HtmlRepository(this.getProjectPath());\n        let headersRepository = new HeadersRepository(this.getProjectPath());\n        let crawlerRepository = new CrawlerRepository(this.args, this.option, this.getProjectPath());\n\n        let crawlStatesRepository = new SqliteCrawlStatesRepository(\n            this.getProjectPath()\n        );\n        crawlerRepository.crawlStatesRepository = crawlStatesRepository;\n\n        const initUrl = this.args.getSingleUrl();\n        if (this.args.isSingle() && initUrl != null) {\n            crawlStatesRepository.initUrlsPool([initUrl]);\n        }\n        crawlerRepository\n            .findAllUrls((progress: Progress) => {\n                this.emitProgress(progress);\n                if (this.args.html && progress.url != null && progress.html != null) {\n                    htmlRepository.save(progress.url, progress.html).then();\n                }\n                if (this.args.headers && progress.url != null && progress.headers != null) {\n                    headersRepository.save(progress.url, progress.headers).then();\n                }\n            })\n            .then(urls => {\n                urlsRepository.save(urls).then(() => this.emitComplete());\n            });\n    }\n}\n"],"file":"CrawlService.js"}