{"version":3,"sources":["../../src/Service/Service.js"],"names":["Service","constructor","args","events","Map","optionsRepository","OptionsRepository","option","getOption","on","event","callback","set","emitProgress","progress","forEach","emitComplete","getProjectPath","siteName","getSiteName","projectPath","output","filename","getUrlsPath","urlsPath","getPathJsonUrlsFile"],"mappings":"6FACA,sBACA,0BAEA,0FACA,2DACA,+DACA,mE,kFAEA;;GAGe,KAAMA,CAAAA,OAAQ,CACzB;;OADyB,CAKzB;;OALyB,CASzB;;OATyB,CAczB;;OAGAC,WAAW,CAACC,IAAD,CAAa,CACpB,KAAKA,IAAL,CAAYA,IAAZ,CACA,KAAKC,MAAL,CAAc,GAAIC,CAAAA,GAAlB,CACA,KAAMC,CAAAA,iBAAiB,CAAG,GAAIC,2BAAJ,CAAsB,KAAKJ,IAA3B,CAA1B,CACA,KAAKK,MAAL,CAAcF,iBAAiB,CAACG,SAAlB,EACjB,CAED;;;;;OAMAC,EAAE,CAACC,KAAD,CAAgBC,QAAhB,CAA6C,CAC3C,KAAKR,MAAL,CAAYS,GAAZ,CAAgBF,KAAhB,CAAuBC,QAAvB,EACA,MAAO,KACV,CAED;;;OAIAE,YAAY,CAACC,QAAD,CAAqB,CAC7B,KAAKX,MAAL,CAAYY,OAAZ,CAAoB,CAACJ,QAAD,CAAWD,KAAX,GAAqB,CACrC,GAAIA,KAAK,GAAK,UAAd,CAA0B,CACtBC,QAAQ,CAACG,QAAD,CACX,CACJ,CAJD,CAKH,CAED;;OAGAE,YAAY,EAAG,CACX,KAAKb,MAAL,CAAYY,OAAZ,CAAoB,CAACJ,QAAD,CAAWD,KAAX,GAAqB,CACrC,GAAIA,KAAK,GAAK,UAAd,CAA0B,CACtBC,QAAQ,EACX,CACJ,CAJD,CAKH,CAED;;OAGAM,cAAc,EAAW,CACrB,GAAIC,CAAAA,QAAQ,CAAG,KAAKhB,IAAL,CAAUiB,WAAV,EAAf,CACA,GAAIC,CAAAA,WAAW,CAAG,eAAK,KAAKlB,IAAL,CAAUmB,MAAV,CAAiBC,QAAtB,CAAgCJ,QAAhC,CAAlB,CACA,GAAI,CAAC,mBAAWE,WAAX,CAAL,CAA8B,CAC1B,kBAAUA,WAAV,CACH,CACD,MAAOA,CAAAA,WACV,CAED;;OAGAG,WAAW,EAAW,CAClB,GAAIC,CAAAA,QAAQ,CAAG,eAAK,KAAKP,cAAL,EAAL,CAA4B,MAA5B,CAAf,CACA,GAAI,CAAC,mBAAWO,QAAX,CAAL,CAA2B,CACvB,kBAAUA,QAAV,CACH,CACD,MAAOA,CAAAA,QACV,CAED;;OAGAC,mBAAmB,EAAW,CAC1B,MAAO,eAAK,KAAKF,WAAL,EAAL,CAAyB,WAAzB,CACV,CAtFwB,C","sourcesContent":["// @flow\r\nimport {existsSync, mkdirSync} from \"fs\";\r\nimport {join} from \"path\";\r\n\r\nimport OptionsRepository from \"../Repository/OptionsRepository\";\r\nimport Args from \"../Model/Args\";\r\nimport Option from \"../Model/Option\";\r\nimport Progress from \"../Model/Progress\";\r\n\r\n/**\r\n * Base service will events and project folder information.\r\n */\r\nexport default class Service {\r\n    /**\r\n     * Received from the user.\r\n     */\r\n    args: Args;\r\n    /**\r\n     * Events emitted by the services.\r\n     */\r\n    events: Map<string, Function>;\r\n    /**\r\n     * Options loaded for the crawl.\r\n     */\r\n    option: Option;\r\n\r\n    /**\r\n     * Build a service with some arguments.\r\n     */\r\n    constructor(args: Args) {\r\n        this.args = args;\r\n        this.events = new Map();\r\n        const optionsRepository = new OptionsRepository(this.args);\r\n        this.option = optionsRepository.getOption();\r\n    }\r\n\r\n    /**\r\n     * Added an event watcher.\r\n     * @param event {string} name of the event.\r\n     *  options: progress,complete\r\n     * @param callback {Function} when an event is emitted.\r\n     */\r\n    on(event: string, callback: function): Service {\r\n        this.events.set(event, callback);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Emit the progress of the service.\r\n     * @param progress {Progress} of the service.\r\n     */\r\n    emitProgress(progress: Progress) {\r\n        this.events.forEach((callback, event) => {\r\n            if (event === \"progress\") {\r\n                callback(progress);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Emit that the service has completed it's job.\r\n     */\r\n    emitComplete() {\r\n        this.events.forEach((callback, event) => {\r\n            if (event === \"complete\") {\r\n                callback();\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Get the full path to the project folder, which is the output folder + domain striped.\r\n     */\r\n    getProjectPath(): string {\r\n        let siteName = this.args.getSiteName();\r\n        let projectPath = join(this.args.output.filename, siteName);\r\n        if (!existsSync(projectPath)) {\r\n            mkdirSync(projectPath);\r\n        }\r\n        return projectPath;\r\n    }\r\n\r\n    /**\r\n     * Get the full path to the urls folder, which is the project path + urls.\r\n     */\r\n    getUrlsPath(): string {\r\n        let urlsPath = join(this.getProjectPath(), \"urls\");\r\n        if (!existsSync(urlsPath)) {\r\n            mkdirSync(urlsPath);\r\n        }\r\n        return urlsPath;\r\n    }\r\n\r\n    /**\r\n     * Get the path to the urls.json file.\r\n     */\r\n    getPathJsonUrlsFile(): string {\r\n        return join(this.getUrlsPath(), \"urls.json\");\r\n    }\r\n}\r\n"],"file":"Service.js"}